# 항암LLM 시스템 아키텍처

## 전체 시스템 구성

```
┌─────────────────────────────────────────────────────────────────┐
│                        항암LLM 시스템                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   React Frontend │    │  Express Backend │    │  vLLM Server │ │
│  │   (Port: 3000)   │◄──►│   (Port: 3001)   │◄──►│ (Port: 8002) │ │
│  └─────────────────┘    └─────────────────┘    └──────────────┘ │
│           │                       │                       │     │
│           │                       │                       │     │
│           ▼                       ▼                       ▼     │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐ │
│  │   Chat Interface │    │   API Gateway   │    │ BGE Embedding │ │
│  │   File List      │    │   Session Mgmt  │    │   Model      │ │
│  │   File Preview   │    │   Document Proc │    │ (BAAI/bge-   │ │
│  └─────────────────┘    └─────────────────┘    │ large-en-v1.5)│ │
│                                                 └──────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    ChromaDB Vector Store                    │ │
│  │                     (Port: 8001)                            │ │
│  │  ┌─────────────────────────────────────────────────────────┐ │ │
│  │  │              Document Embeddings                        │ │ │
│  │  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │ │ │
│  │  │  │   PDF Docs  │ │  Excel Docs │ │   Text Docs │       │ │ │
│  │  │  │  (Chunked)  │ │  (Chunked)  │ │  (Chunked)  │       │ │ │
│  │  │  └─────────────┘ └─────────────┘ └─────────────┘       │ │ │
│  │  └─────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 핵심 컴포넌트 상세 설명

### 1. 프론트엔드 (React)
- **포트**: 3000
- **주요 기능**:
  - 채팅 인터페이스
  - 파일 목록 및 미리보기
  - 세션 관리 (새 대화, 이전 대화)
  - Markdown 렌더링

### 2. 백엔드 (Express.js)
- **포트**: 3001
- **주요 기능**:
  - API Gateway
  - 세션 관리 (`/api/chat/sessions`)
  - 문서 처리 (`enhanced_document_processor.js`)
  - RAG 검색 및 응답 생성

### 3. vLLM Embedding Server
- **포트**: 8002
- **모델**: BAAI/bge-large-en-v1.5
- **기능**: 텍스트 임베딩 생성

### 4. ChromaDB Vector Store
- **포트**: 8001
- **기능**: 
  - 문서 임베딩 저장
  - 벡터 유사도 검색
  - 하이브리드 검색 (벡터 + 키워드)

## RAG (Retrieval-Augmented Generation) 플로우

```
1. 사용자 질문 입력
   ↓
2. 질문을 임베딩으로 변환 (vLLM)
   ↓
3. ChromaDB에서 유사한 문서 검색
   ↓
4. 검색된 문서들을 컨텍스트로 결합
   ↓
5. LLM이 컨텍스트를 바탕으로 응답 생성
   ↓
6. 응답을 프론트엔드로 전송
```

## 문서 처리 파이프라인

```
Raw Documents (PDF, Excel, Word)
   ↓
Document Processor (enhanced_document_processor.js)
   ↓
Text Extraction & Chunking
   ↓
Embedding Generation (vLLM)
   ↓
Vector Storage (ChromaDB)
   ↓
Searchable Knowledge Base
```

## 메타데이터 필터링 시스템

- **암종별 필터링**: 신경내분비암, 피부암, 골암 등
- **병기별 필터링**: 1차, 2차, 고식적요법 등
- **약물명 필터링**: Pembrolizumab, Paclitaxel 등

## 하이브리드 검색

1. **벡터 유사도 검색**: 의미적 유사성 기반
2. **키워드 검색**: 정확한 용어 매칭
3. **메타데이터 필터링**: 암종, 병기, 약물명 기준
4. **결과 랭킹**: 유사도 점수 기반 정렬

## 세션 관리

- **세션 생성**: `/api/chat/sessions` (POST)
- **세션 조회**: `/api/chat/sessions/:id` (GET)
- **메시지 히스토리**: `/api/chat/sessions/:id/history` (GET)
- **세션 삭제**: `/api/chat/sessions/:id` (DELETE)

## 보안 및 성능

- **포트 격리**: 각 서비스별 독립 포트
- **세션 격리**: 사용자별 대화 세션 분리
- **캐싱**: 임베딩 결과 캐싱
- **에러 핸들링**: 각 단계별 예외 처리 